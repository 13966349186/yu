<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>飞</title>
    <style type="text/css">
        canvas {
            border: 1px solid #f00;
        }

        .start-img {
            width: 100vw;
            height: 100vh;

        }

        .absolute-img {
            height: 80px;
            width: 80px;
            position: absolute;
            top: 50px;

            left: calc(50vw - 40px);
        }
    </style>
</head>
<body>
<div class="start-img" id="start-img">
    <img src="./images/start.png" style="height: 100%;width: 100%">
    <img src="./images/button.png" class="absolute-img" onclick="ttt()">
</div>

<canvas style="width: 100vw" id="cvs" width="500" height="500"></canvas>
</body>
</html>
<script type="text/javascript" src="./loadImages.js"></script>
<script type="text/javascript" src="./Sky.js"></script>
<script type="text/javascript" src="./Bird.js"></script>
<script type="text/javascript" src="./Pipe.js"></script>
<script type="text/javascript" src="./Land.js"></script>
<script type="text/javascript">
    function ttt(e) {
        document.getElementById('start-img').style.display = "none";
        document.getElementById('cvs').style.display = "block";
        this.start();
    }

    var cvs = document.getElementById('cvs');
    var ctx = cvs.getContext('2d');
    //绘制背景
    loadImage({
        "bird": "./images/bird.png",
        "land": "./images/land.png",
        "pipeDown": "./images/pipeDown.png",
        "pipeUp": "./images/pipeUp.png",
        "sky": "./images/sky.png"
    }, function (imgobj) {
        cvs.width = imgobj.sky.width;
        cvs.height = imgobj.sky.height;
        //创建背景实例
        var sky1 = new Sky(ctx, imgobj.sky, 2);
        var sky2 = new Sky(ctx, imgobj.sky, 2);

        //创建地面实例
        var Land1 = new Land(ctx, imgobj.land, 2);
        var Land2 = new Land(ctx, imgobj.land, 2);
        var Land3 = new Land(ctx, imgobj.land, 2);
        var Land4 = new Land(ctx, imgobj.land, 2);

        //创建小鸟
        var bird = new Bird(ctx, imgobj.bird, 3, 1, 10, 10);

        var pipe1 = new Pipe(ctx, imgobj.pipeDown, imgobj.pipeUp, 150, imgobj.land.height);
        var pipe2 = new Pipe(ctx, imgobj.pipeDown, imgobj.pipeUp, 150, imgobj.land.height);
        var pipe3 = new Pipe(ctx, imgobj.pipeDown, imgobj.pipeUp, 150, imgobj.land.height);
        var pipe4 = new Pipe(ctx, imgobj.pipeDown, imgobj.pipeUp, 150, imgobj.land.height);
        var pipe5 = new Pipe(ctx, imgobj.pipeDown, imgobj.pipeUp, 150, imgobj.land.height);
        var pipe6 = new Pipe(ctx, imgobj.pipeDown, imgobj.pipeUp, 150, imgobj.land.height);
        var timer = setInterval(function () {
            var birdCenterX = bird.x + bird.width / 2;
            var birdCenterY = bird.y + bird.height / 2;
            if (ctx.isPointInPath(birdCenterX, birdCenterY) || (birdCenterY < 0) || (birdCenterY > this.ctx.canvas.height - imgobj.land.height)) {
                clearInterval(timer);
                ctx.fillStyle = "rgba(300,300,300,0.5)";
                ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.font = "50px 微软雅黑";
                ctx.fillStyle = "red";
                ctx.fillText("GAME OVER!!!", this.ctx.canvas.width / 2, this.ctx.canvas.height / 2);
                return;
            }
            sky1.draw();
            sky1.updata();
            sky2.draw();
            sky2.updata();

            ctx.beginPath();
            pipe1.draw();
            pipe1.updata();
            pipe2.draw();
            pipe2.updata();
            pipe3.draw();
            pipe3.updata();
            pipe4.draw();
            pipe4.updata();
            pipe5.draw();
            pipe5.updata();
            pipe6.draw();
            pipe6.updata();

            Land1.draw();
            Land1.updata();
            Land2.draw();
            Land2.updata();
            Land3.draw();
            Land3.updata();
            Land4.draw();
            Land4.updata();

            bird.draw();
            bird.updata();
        }, 50);

    })

</script>